<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_74) on Sat May 28 01:49:42 BST 2016 -->
<title>CustomKeyEquivalence (Koloboke Compile Annotations 0.5)</title>
<meta name="date" content="2016-05-28">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CustomKeyEquivalence (Koloboke Compile Annotations 0.5)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CustomKeyEquivalence.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/koloboke/compile/ConcurrentModificationUnchecked.html" title="annotation in com.koloboke.compile"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/koloboke/compile/KolobokeMap.html" title="annotation in com.koloboke.compile"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/koloboke/compile/CustomKeyEquivalence.html" target="_top">Frames</a></li>
<li><a href="CustomKeyEquivalence.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li>Optional</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Element</li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.koloboke.compile</div>
<h2 title="Annotation Type CustomKeyEquivalence" class="title">Annotation Type CustomKeyEquivalence</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true" title="class or interface in java.lang.annotation">@Retention</a>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true#value--" title="class or interface in java.lang.annotation">value</a>=<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/RetentionPolicy.html?is-external=true#SOURCE" title="class or interface in java.lang.annotation">SOURCE</a>)
 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true" title="class or interface in java.lang.annotation">@Target</a>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true#value--" title="class or interface in java.lang.annotation">value</a>=<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html?is-external=true#TYPE" title="class or interface in java.lang.annotation">TYPE</a>)
public @interface <span class="memberNameLabel">CustomKeyEquivalence</span></pre>
<div class="block">Indicates that the annotated <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util"><code>Map</code></a>- or <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Set.html?is-external=true" title="class or interface in java.util"><code>Set</code></a>-like class or interface with a reference
 <a href="../../../com/koloboke/compile/KolobokeMap.html#model">key type</a> uses a custom
 equivalence strategy when comparing keys. If this annotation is applied to a <a href="../../../com/koloboke/compile/KolobokeMap.html" title="annotation in com.koloboke.compile"><code>@KolobokeMap</code></a>- or <a href="../../../com/koloboke/compile/KolobokeSet.html" title="annotation in com.koloboke.compile"><code>@KolobokeSet</code></a>-annotated class or interface,
 Koloboke Compile checks that
 <ol>
     <li><a href="../../../com/koloboke/compile/KolobokeMap.html#model">the key type</a> of
     the annotated class or interface is a reference type (a declared type, or an array type, or
     a type variable);</li>
     <li>there are two non-abstract, non-private methods are declared or inherited in the
     annotated type,
     <a href="../../../com/koloboke/compile/KolobokeMap.html#method-form-matching">matching the
     following forms</a>:
     <table BORDER CELLPADDING=3 CELLSPACING=1 summary="Custom key equivalence forms">
         <tr><td ALIGN=RIGHT><code>boolean</code></td>
             <td><code>keyEquals(KeyType queriedKey, KeyType keyInContainer)</code></td></tr>
         <tr><td ALIGN=RIGHT><code>int</code></td>
             <td><code>keyHashCode(KeyType key)</code></td></tr>
     </table></li>
 </ol>

 If either of the conditions is not true, Koloboke Compile emits a compilation error and doesn't
 generate an implementation for the annotated type.

 <p><code>keyEquals()</code> and <code>keyHashCode()</code> must obey general equivalence relation rules
 (see <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang"><code>Object.equals(Object)</code></a> and <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang"><code>Object.hashCode()</code></a> specifications for details).

 <p>Koloboke Compile provides the following guarantees on how it calls <code>keyEquals()</code> and
 <code>keyHashCode()</code> inside generated implementations:
 <ul>
     <li>Both arguments of <code>keyEquals()</code> are never <code>null</code>.</li>
     <li>The argument of <code>keyHashCode()</code> is never <code>null</code>.</li>
     <li>The second argument of <code>keyEquals()</code> call is present in the map (or the set) or
     used to be present, but removed later. It means that if the implemented type has some
     restrictions on the keys that it may contain, those restrictions apply to the second
     argument. From performance perspective, since the second argument has already been inserted
     into the set or map, if it caches hashcode a-la <code>String</code>, the <code>keyEquals()</code>
     implementation may benefit from the knowledge that the hashcode of the second argument
     is already computed and cached.</li>
     <li>Arguments of <code>keyEquals()</code> are never identical (i. e. not references to the same
     object). In particular, this means that to have <a href="http://docs.oracle.com/javase/8/docs/api/java/util/IdentityHashMap.html?is-external=true" title="class or interface in java.util"><code>IdentityHashMap</code></a>-like behaviour
     <code>keyEquals()</code> should be implemented as just returning <code>false</code>: <pre><code>
 &#064;KolobokeMap
 &#064;CustomKeyEquivalence
 abstract class IdentityToIntMap&lt;K&gt; implements Map&lt;K, Integer&gt; {

     static &lt;K&gt; IdentityToIntMap&lt;K&gt; withExpectedSize(int expectedSize) {
         return new KolobokeIdentityToIntMap&lt;K&gt;(expectedSize);
     }

     abstract int getInt(K key);
     abstract int put(K key, int value);

     final boolean keyEquals(K queriedKey, K keyInMap) {
         return false;
     }

     final int keyHashCode(K key) {
         return System.identityHashCode(key);
     }
 }</code></pre>
     </li>
 </ul>

 <p><code>keyEquals()</code> and <code>keyHashCode()</code> don't belong to any public interface provided
 by the Koloboke Collections API or Koloboke Compile. So <code>@CustomKeyEquivalence</code> is kind
 of a substitute of the <code>@Override</code> annotation for these methods. Koloboke Compile just
 checks that methods are present, accessible from the generated subclass and have proper argument
 types. It's <i>a user responsibility</i> to make these methods consistent with each other and
 providing a valid equivalence relationship in the domain of the keys. See examples of valid
 equivalences in the documentation to the following methods: <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/Equivalence.html?is-external=true#charSequence--" title="class or interface in com.koloboke.collect"><code>Equivalence.charSequence()</code></a>,
 <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/Equivalence.html?is-external=true#caseInsensitive--" title="class or interface in com.koloboke.collect"><code>Equivalence.caseInsensitive()</code></a>.

 <p>If the annotated type implements <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/set/ObjSet.html?is-external=true" title="class or interface in com.koloboke.collect.set"><code>ObjSet</code></a> or <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/map/ObjObjMap.html?is-external=true" title="class or interface in com.koloboke.collect.map"><code>ObjObjMap</code></a> or other
 <code>ObjXxxMap</code> interface from the Koloboke Collections API, <i>and</i> it declares <code>equals()</code> method abstract to make Koloboke Compile implement it, or it declares <code>keySet()</code>
 or <code>entrySet()</code> methods abstract and expects Koloboke Compile
 to implement <code>equals()</code> methods correctly in the returned <code>Set</code> views of the map,
 <i>it's a user responsibility</i> to implement <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/ObjCollection.html?is-external=true#equivalence--" title="class or interface in com.koloboke.collect"><code>ObjCollection.equivalence()</code></a> or <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/map/ObjObjMap.html?is-external=true#keyEquivalence--" title="class or interface in com.koloboke.collect.map"><code>ObjObjMap.keyEquivalence()</code></a> or similar method in the extended
 <code>ObjXxxMap</code> interface and return from it an <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/Equivalence.html?is-external=true" title="class or interface in com.koloboke.collect"><code>Equivalence</code></a> object that reflects <code>keyEquals()</code> and <code>keyHashCode()</code> strategy. For example, here is how a <code>@KolobokeMap</code>
 with configurable key equivalence should be declared: <a name="configurable-key-equivalence-map">
 </a><pre><code>
 &#064;KolobokeMap
 &#064;CustomKeyEquivalence
 abstract class ConfigurableKeyEquivalenceMap&lt;K&gt; implements HashObjLongMap&lt;K&gt; {

     static &lt;K&gt; HashObjLongMap&lt;K&gt; with(
             &#064;Nonnull Equivalence&lt;? super K&gt; keyEquivalence, int expectedSize) {
         return new KolobokeConfigurableKeyEquivalenceMap&lt;K&gt;(keyEquivalence, expectedSize);
     }

     &#064;Nonnull
     private final Equivalence&lt;? super K&gt; keyEquivalence;

     ConfigurableKeyEquivalenceMap(&#064;Nonnull Equivalence&lt;? super K&gt; keyEquivalence) {
         this.keyEquivalence = keyEquivalence;
     }

     final boolean keyEquals(K queriedKey, K keyInMap) {
         return keyEquivalence.equivalent(queriedKey, keyInMap);
     }

     final int keyHashCode(K key) {
         return keyEquivalence.hash(key);
     }

     &#064;SuppressWarnings("unchecked")
     &#064;Nonnull
     &#064;Override
     public final Equivalence&lt;K&gt; keyEquivalence() {
         return (Equivalence&lt;K&gt;) keyEquivalence;
     }
 }</code></pre>

 <p>In the Koloboke Collections's API, custom key equivalence strategy for sets or maps is
 configured by methods <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/set/hash/HashObjSetFactory.html?is-external=true#withEquivalence-com.koloboke.collect.Equivalence-" title="class or interface in com.koloboke.collect.set.hash"><code>HashObjSetFactory.withEquivalence(Equivalence)</code></a> or <a href="http://leventov.github.io/Koloboke/api/1.0/java8/com/koloboke/collect/map/hash/HashObjObjMapFactory.html?is-external=true#withKeyEquivalence-com.koloboke.collect.Equivalence-" title="class or interface in com.koloboke.collect.map.hash"><code>HashObjObjMapFactory.withKeyEquivalence(Equivalence)</code></a> or similar methods in <code>HashObjXxxMapFactory</code> interfaces.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../com/koloboke/compile/KolobokeMap.html#custom-key-equivalence">Custom
 key equivalence section in the <code>@KolobokeMap</code> specification</a>, 
<a href="../../../com/koloboke/compile/KolobokeMap.html#set-custom-key-equivalence">Custom
 key equivalence section in the <code>@KolobokeMap</code> specification</a></dd>
</dl>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CustomKeyEquivalence.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/koloboke/compile/ConcurrentModificationUnchecked.html" title="annotation in com.koloboke.compile"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/koloboke/compile/KolobokeMap.html" title="annotation in com.koloboke.compile"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/koloboke/compile/CustomKeyEquivalence.html" target="_top">Frames</a></li>
<li><a href="CustomKeyEquivalence.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li>Optional</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Element</li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
